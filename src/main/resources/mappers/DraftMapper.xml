<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sicau.one_car.dao.DraftDao">
    <resultMap id="BaseDraftWithLabel" type="com.sicau.one_car.entity.dto.DraftDto">
        <id column="draft_id" jdbcType="VARCHAR" property="draftId"/>
        <result column="content" jdbcType="VARCHAR" property="content"/>
        <result column="img_src" jdbcType="VARCHAR" property="imgSrc"/>
        <result column="user_id" jdbcType="VARCHAR" property="userId"/>
        <result column="username" jdbcType="VARCHAR" property="username"/>
        <result column="view_num" jdbcType="INTEGER" property="viewNum"/>
        <result column="like_num" jdbcType="INTEGER" property="likeNum"/>
        <result column="create_time" jdbcType="DATE" property="createTime"/>
        <collection property="labels" ofType="com.sicau.one_car.entity.po.Label" >
            <id column="label_id" jdbcType="INTEGER" property="label_id"/>
            <result column="label_name" jdbcType="VARCHAR" property="labelName"/>
        </collection>
    </resultMap>
    <insert id="insertDraft" parameterType="com.sicau.one_car.entity.dto.DraftDto" >
         insert into draft_tb(draft_id, content, img_src, user_id, view_num, like_num,create_time)
         values (#{draftId},#{content},#{imgSrc},
         #{userId},#{viewNum},#{likeNum},#{createTime})
    </insert>
    <select id="selectDraftWithLabel"  resultMap="BaseDraftWithLabel">
        select d.draft_id,d.content,d.img_src,d.user_id,u.username,d.view_num,d.like_num,d.create_time,
        l.label_id,l.label_name
        from draft_tb d
        left join user_tb u on u.user_id=d.user_id
        left join draft_label dl on dl.draft_id=d.draft_id
        left join label_tb l on l.label_id=dl.label_id where d.draft_id=#{id};
    </select>
</mapper>

